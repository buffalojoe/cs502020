#include <stdio.h>
#include <cs50.h>
#include <math.h>

int main(void)
{
    // Declare and initialize a variable and request input (A credit card number)
    long cc = 0;
    long ccNumber = 0;
    do
    {
        ccNumber = get_long("Credit Card Number: \n");
    }
    while (ccNumber <= 0);

    cc = ccNumber;

    // Determine the number of digits in the CC number
    int digits = 0;
    while (ccNumber > 0)
    {
        ccNumber /= 10;
        digits++;
    }

    printf("%li\n", cc);
    printf("%li\n", ccNumber);

    if (digits != 13 && digits != 15 && digits != 16)
    {
        printf("INVALID\n");
    }

    // check for card length and starting digits
    if (cc < 1000000000000 || cc > 9999999999999999)
    {
        printf("INVALID\n");
    }
    else if ((cc >= 340000000000000 && cc < 350000000000000) || (cc >= 370000000000000 && cc < 380000000000000))
    {
        printf("AMEX\n");
    }
    else if (cc >= 5100000000000000 && cc < 5600000000000000)
    {
        printf("MASTERCARD\n");
    }
    else if ((cc >= 4000000000000 && cc < 5000000000000) || (cc >= 4000000000000000 && cc < 5000000000000000))
    {
        // checksum
        long d1 = cc % 10;
        long d2 = (cc - d1) % 100;
        while (d2 >= 10)
        {
            d2 = d2 / 10;
        }
        long d3 = (cc - (d2 * 10) - d1) % 1000;
        while (d3 >= 10)
        {
            d3 = d3 / 10;
        }
        long d4 = (cc - (d3 * 100) - (d2 * 10) - d1) % 10000;
        while (d4 >= 10)
        {
            d4 = d4 / 10;
        }
        long d5 = (cc - (d4 * 1000) - (d3 * 100) - (d2 * 10) - d1) % 100000;
        while (d5 >= 10)
        {
            d5 = d5 / 10;
        }
        long d6 = (cc - (d5 * 10000) - (d4 * 1000) - (d3 * 100) - (d2 * 10) - d1) % 1000000;
        while (d6 >= 10)
        {
            d6 = d6 / 10;
        }
        long d7 = (cc - (d6 * 100000) - (d5 * 10000) - (d4 * 1000) - (d3 * 100) - (d2 * 10) - d1) % 10000000;
        while (d7 >= 10)
        {
            d7 = d7 / 10;
        }
        long d8 = (cc - (d7 * 1000000) - (d6 * 100000) - (d5 * 10000) - (d4 * 1000) - (d3 * 100) - (d2 * 10) - d1) % 100000000;
        while (d8 >= 10)
        {
            d8 = d8 / 10;
        }
        long d9 = (cc - (d8 * 10000000) - (d7 * 1000000) - (d6 * 100000) - (d5 * 10000) - (d4 * 1000) - (d3 * 100) -
            (d2 * 10) - d1) % 1000000000;
        while (d9 >= 10)
        {
            d9 = d9 / 10;
        }
        long d10 = (cc - (d9 * 100000000) - (d8 * 10000000) - (d7 * 1000000) - (d6 * 100000) - (d5 * 10000) -
            (d4 * 1000) - (d3 * 100) - (d2 * 10) - d1) % 10000000000;
        while (d10 >= 10)
        {
            d10 = d10 / 10;
        }
        long d11 = (cc - (d10 * 1000000000) - (d9 * 100000000) - (d8 * 10000000) - (d7 * 1000000) - (d6 * 100000) -
            (d5 * 10000) - (d4 * 1000) - (d3 * 100) - (d2 * 10) - d1) % 100000000000;
        while (d11 >= 10)
        {
            d11 = d11 / 10;
        }
        long d12 = (cc - (d11 * 10000000000) - (d10 * 1000000000) - (d9 * 100000000) - (d8 * 10000000) -
            (d7 * 1000000) - (d6 * 100000) - (d5 * 10000) - (d4 * 1000) - (d3 * 100) - (d2 * 10) - d1) % 1000000000000;
        while (d12 >= 10)
        {
            d12 = d12 / 10;
        }
        long d13 = (cc - (d12 * 100000000000) - (d11 * 10000000000) - (d10 * 1000000000) - (d9 * 100000000) -
            (d8 * 10000000) - (d7 * 1000000) - (d6 * 100000) - (d5 * 10000) - (d4 * 1000) - (d3 * 100) - (d2 * 10) - d1) % 10000000000000;
        while (d13 >= 10)
        {
            d13 = d13 / 10;
        }
        long d14 = (cc - (d13 * 1000000000000) - (d12 * 100000000000) - (d11 * 10000000000) - (d10 * 1000000000) - (d9 * 100000000) -
            (d8 * 10000000) - (d7 * 1000000) - (d6 * 100000) - (d5 * 10000) - (d4 * 1000) - (d3 * 100) - (d2 * 10) - d1) % 100000000000000;
        while (d14 >= 10)
        {
            d14 = d14 / 10;
        }
        long d15 = (cc - (d14 * 10000000000000) - (d13 * 1000000000000) - (d12 * 100000000000) - (d11 * 10000000000) -
            (d10 * 1000000000) - (d9 * 100000000) - (d8 * 10000000) - (d7 * 1000000) - (d6 * 100000) - (d5 * 10000) - (d4 * 1000) - (d3 * 100) - (d2 * 10) - d1) % 1000000000000000;
        while (d15 >= 10)
        {
            d15 = d15 / 10;
        }
        long d16 = cc / 1000000000000000;
        int sum0 = (((d16 * 2) % 10 + (d16 * 2) / 10) + ((d14 * 2) % 10 + (d14 * 2) / 10) + ((d12 * 2) % 10 + (d12 * 2) / 10) + ((d10 * 2) % 10 + (d10 * 2) / 10) +
            ((d8 * 2) % 10 + (d8 * 2) / 10) + ((d6 * 2) % 10 + (d6 * 2) / 10) + ((d4 * 2) % 10 + (d4 * 2) / 10) + ((d2 * 2) % 10 + (d2 * 2) / 10));
        int sum1 = (sum0 + d15 + d13 + d11 + d9 + d7 + d5 + d3 + d1);
        if (sum1 % 10 == 0)
        {
            printf("VISA\n");
        }
        else
        {
            printf("INVALID\n");
        }
    }
    else
    {
        printf("INVALID\n");
    }

}